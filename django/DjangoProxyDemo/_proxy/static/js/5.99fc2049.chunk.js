(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{949:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),l=r(625),o=r(18),c=r(42),s=r(1),i=r(76),u=r(70),m=r(48),d=r(10),f=r(63),E=r(43),h=r(2),v=r(12),b=r(32),p=r(68),g=r(13),x=r(99),y=r(20),w=r(55);function R(e){var t=e.roles,r=e.roleUsers,a=e.total,l=e.onLoadMoreRows,o=e.onEdit,c=e.onDelete,s=n.useCallback(function(e){var t=e.dataSelected,a=e.setSelected,l=t.filter(function(e){return(r[e.role]||[]).length>0}).length;return n.createElement(h.Box,null,n.createElement(b.a,{resource:v.c.Roles,action:v.a.Delete,yes:n.createElement(w.a,{content:l>0?"Cannot perform delete because ".concat(1===l?"the selected role still has":"".concat(l," selected roles still have")," users assigned"):"Delete"},n.createElement(d.a,{variant:"inverse",disabled:l>0,onClick:function(){c(t),a([])}},"Delete"))}))},[c,r]),i=n.useCallback(function(e){var t=e.selected,r=e.onChangeSelected;return function(e){var a=e.rowIndex,l=e.rowData,o=t.includes(a);return n.createElement(h.Flex,null,n.createElement(h.Box,{flex:"0 1 auto"},n.createElement("label",null,n.createElement(p.a,{checked:o,onChange:function(){return r(a,!o)}}))),n.createElement(h.Box,{ml:3,flex:"1"},n.createElement(y.a,{variant:"body.secondary"},l.role)))}},[]),u=n.useCallback(function(){return function(e){var t=e.rowData;if(!t)return null;var a=r[t.role]||[];return n.createElement(h.Flex,{flexDirection:"row-reverse",mr:-1},n.createElement(b.a,{resource:v.c.Roles,action:v.a.Delete,yes:0===a.length?n.createElement(w.a,{content:"Delete"},n.createElement(d.a,{mx:1,onClick:function(){c([t])},variant:"icon"},n.createElement(g.a,{icon:"trash"}))):n.createElement(h.Box,{mx:1,flex:"0 0 40px"})}),n.createElement(b.a,{resource:v.c.Roles,action:v.a.Update,yes:n.createElement(w.a,{content:"Edit"},n.createElement(d.a,{mx:1,onClick:function(){o(t)},variant:"icon"},n.createElement(g.a,{icon:"edit"})))}))}},[r,o,c]);return n.createElement(x.a,{total:a,bulkActionsRenderer:s,data:t,resource:v.c.Roles,onLoadMoreRows:l},function(e){return[n.createElement(E.d,{key:"role",cellDataGetter:function(){},flexGrow:2,width:2/6,dataKey:"role",label:"Role",cellRenderer:i(e)}),n.createElement(E.d,{key:"description",cellDataGetter:function(){},flexGrow:3,width:2/6,dataKey:"role",label:"Description",cellRenderer:function(e){var t=e.rowData;return n.createElement(y.a,{variant:"body.secondary"},t.description||"No description")}}),n.createElement(E.d,{key:"users",cellDataGetter:function(){},flexGrow:3,width:1/6,dataKey:"role",label:"Users",cellRenderer:function(e){var t=e.rowData,a=r[t.role]||[];return 0===a.length?n.createElement(y.a,{variant:"body.secondary"},"No users currently have this role"):a.length<3?n.createElement(y.a,{variant:"body.secondary"},a.map(function(e){return e.username}).join(" and ")):n.createElement(y.a,{variant:"body.secondary"},a.slice(0,2).map(function(e){return e.username}).join(", "),n.createElement("b",null," +",a.length-2," more"))}}),n.createElement(E.d,{key:"role",cellDataGetter:function(){},flexGrow:1,width:1/6,dataKey:"role",label:"",cellRenderer:u()})]})}function C(e){var t=e.roleUsers,r=e.roles,a=e.total,l=e.onLoadMoreRows,o=e.onNavigate,c=e.onDeleteRole,s=n.useCallback(function(e){return o("/roles/".concat(e.role))},[o]);return n.useEffect(function(){l({search:"",offset:0,limit:0})},[l]),n.createElement(f.a,{title:"Roles",rightContent:n.createElement(d.a,{variant:"primary",large:!0,onClick:function(){return o("/roles/create")},mr:4},"Create new role")},n.createElement(R,{roleUsers:t,roles:r,total:a,onLoadMoreRows:l,onEdit:s,onDelete:c}))}var j={onFetchRoles:m.d.request,onDeleteRole:m.a.request};var U=Object(l.g)(Object(c.b)(function(e){return{roles:e.roles.roles,roleUsers:e.roles.roleUsers,userRole:e.auth.role,total:e.roles.total}},j)(function(e){var t=e.history,r=Object(o.a)(e,["history"]);return n.createElement(i.a,{listener:u.b,start:Object(s.getType)(m.d.request),resolve:Object(s.getType)(m.d.success),reject:Object(s.getType)(m.d.failure)},function(e){return n.createElement(C,Object.assign({},r,{onNavigate:t.push,onLoadMoreRows:e}))})})),k=r(54),O=r(4),D=r(9),F=r(286),B=r(211),S=r(69),M=r(28);function q(e){return a.a.createElement(d.a,Object.assign({variant:"icon",color:"neutral_8"},e),a.a.createElement(g.a,{icon:["fas","arrow-left"]}))}var N,G=r(64),A=r(52),P=r(142),L=r(29),_=r(27);function K(e,t){return[].concat(Object(_.a)(e?["read:any"]:[]),Object(_.a)(t?["create:any","update:any","delete:any"]:[]))}function V(e){var t=e.value,r=e.permission,a=e.onChange,l=t.includes("read:any"),o=t.includes("create:any");return n.createElement(h.Flex,{py:3},n.createElement(h.Box,{flex:4,width:4/6},n.createElement(y.a,null,r.label)),n.createElement(h.Box,{flex:1,width:1/6},!r.cannotView&&n.createElement("label",null,n.createElement(p.a,{checked:l,onChange:function(){return a(K(!l,o))}}))),n.createElement(h.Box,{flex:1,width:1/6},!r.cannotModify&&n.createElement("label",null,n.createElement(p.a,{checked:o,onChange:function(){return a(K(l,!o))}}))))}function I(e){var t=e.value,r=e.onChange,a=e.permissions;return n.createElement(h.Box,null,n.createElement(h.Flex,{py:3},n.createElement(h.Box,{flex:4,width:4/6},n.createElement(M.a,{variant:3},"Permissions")),n.createElement(h.Box,{flex:1,width:1/6},n.createElement(M.a,{variant:3},"View")),n.createElement(h.Box,{flex:1,width:1/6},n.createElement(M.a,{variant:3},"Modify"))),a.map(function(e){return n.createElement(V,{key:e.resource,permission:e,value:t[e.resource]||[],onChange:function(n){return r(Object(O.a)({},t,Object(L.a)({},e.resource,n)))}})}))}!function(e){e[e.Permissions=0]="Permissions",e[e.Users=1]="Users"}(N||(N={}));var T={role:"",description:"",is_default:!1,grants:{}};function J(e){var t=e.users,r=e.role,a=e.roleUsers,l=void 0===a?[]:a,o=e.onNavigate,c=e.onSaveRole,s=e.onUpdateRole,i=e.onFetchUsers,u=e.permissions;n.useEffect(function(){i({search:"",limit:0,offset:0})},[i]);var m=n.useState(r||T),E=Object(D.a)(m,2),v=E[0],b=E[1];n.useEffect(function(){r&&b(r)},[r]);var g=n.useCallback(function(e){return b(Object(O.a)({},v,e))},[v]),x=n.useState([]),w=Object(D.a)(x,2),R=w[0],C=w[1];n.useEffect(function(){l&&C(l.map(function(e){return{label:e.username,value:e.username,data:e}}))},[l,l.length]);var j=n.useState(N.Users),U=Object(D.a)(j,2),k=U[0],L=U[1],_=n.useMemo(function(){return Object.values(t).map(function(e){return{label:e.username,value:e.username,data:e}})},[t]);return n.createElement(f.a,{scrollable:!0,title:n.createElement(n.Fragment,null,n.createElement(q,{onClick:function(){return o("/roles")}})," ",r?"Edit":"Create new"," Role"),rightContent:n.createElement(h.Flex,{mr:-2,pr:4,flexDirection:"row-reverse"},n.createElement(d.a,{variant:"primary",onClick:function(){var e=R.map(function(e){return e.data});r?s({currentId:r.role,role:v,users:e}):c({role:v,users:e}),o("/roles")},large:!0,mr:2},r?"Save":"Create"," role"),n.createElement(d.a,{variant:"secondary",onClick:function(){return o("/roles")},large:!0,mr:2},r?"Cancel":"Discard"))},n.createElement(h.Box,{width:2/3,m:"0 auto"},n.createElement(S.a,{borderRadius:"large",p:6,mb:6},n.createElement(M.a,{variant:2,mb:4},"Basic Details"),n.createElement(h.Box,{mb:4,width:"100%"},n.createElement(P.a,{text:"Name"},n.createElement(A.a,{value:v.role,onChangeValue:function(e){return g({role:e})},fullWidth:!0,placeholder:"Role title"}))),n.createElement(h.Box,{mb:4,width:"100%"},n.createElement(P.a,{text:"Description"},n.createElement(A.a,{value:v.description||"",onChangeValue:function(e){return g({description:e})},fullWidth:!0,placeholder:"Access chat logs, analyze and define requirements for updates"}))),n.createElement(h.Flex,{as:"label",alignItems:"center"},n.createElement(p.a,{checked:v.is_default||!1,onChange:function(e){return g({is_default:!v.is_default})},mr:2}),n.createElement(y.a,null,"Set as default roles"))),n.createElement(S.a,{borderRadius:"large",p:6},n.createElement(F.a,{justifyContent:"flex-start",ml:-3,mb:4},n.createElement(B.a,{variant:2,active:k===N.Permissions,onClick:function(){return L(N.Permissions)}},"Add Permissions"),n.createElement(B.a,{variant:2,active:k===N.Users,onClick:function(){return L(N.Users)}},"Add Users")),k===N.Permissions&&n.createElement(I,{permissions:u,value:v.grants,onChange:function(e){return g({grants:e})}}),k===N.Users&&n.createElement(P.a,{text:"Add users to this Role"},n.createElement(G.a,{isMulti:!0,placeholder:"Search users...",options:_,value:R,onChange:function(e){return Array.isArray(e)&&C(e)},hideSelectedOptions:!1})))))}var W={onSaveRole:m.f.request,onUpdateRole:m.g.request,onFetchUsers:k.c.request,onFetchRole:m.b.request,onFetchRoleUsers:m.c.request};var z=Object(l.g)(Object(c.b)(function(e){return{users:e.users.users,permissions:e.roles.permissions,roles:e.roles.roles,roleUsers:e.roles.roleUsers}},W)(function(e){var t=e.history,r=e.roles,a=e.roleUsers,l=e.onFetchRoleUsers,c=e.onFetchRole,s=e.match,i=Object(o.a)(e,["history","roles","roleUsers","onFetchRoleUsers","onFetchRole","match"]),u=s.params.roleName;n.useEffect(function(){u&&(c(u),l(u))},[c,l,u]);var m=n.useMemo(function(){if(u)return Object.values(r).find(function(e){return e.role===u})},[u,r]),d=n.useMemo(function(){return u?a[u]:[]},[u,a]);return n.createElement(n.Fragment,null,n.createElement(J,Object.assign({onNavigate:t.push,role:m,roleUsers:d},i)))}));t.default=Object(l.g)(function(e){var t=e.match;return n.createElement(l.e,null,n.createElement(l.c,{exact:!0,path:t.path,component:U}),n.createElement(l.c,{exact:!0,path:"".concat(t.path,"/create"),component:z}),n.createElement(l.c,{exact:!0,path:"".concat(t.path,"/:roleName"),component:z}))})}}]);
//# sourceMappingURL=5.99fc2049.chunk.js.map